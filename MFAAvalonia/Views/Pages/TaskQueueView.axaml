<?xml version="1.0" encoding="UTF-8"?>

<UserControl d:DesignHeight="450"
             d:DesignWidth="800"
             mc:Ignorable="d"
             x:Class="MFAAvalonia.Views.Pages.TaskQueueView"
             x:DataType="pages:TaskQueueViewModel"
             xmlns="https://github.com/avaloniaui"
             xmlns:System="clr-namespace:System;assembly=System.Runtime"
             xmlns:binding="clr-namespace:MaaFramework.Binding;assembly=MaaFramework.Binding"
             xmlns:calcBinding="clr-namespace:CalcBinding;assembly=CalcBindingAva"
             xmlns:converters="clr-namespace:MFAAvalonia.Helper.Converters"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:ex="clr-namespace:MFAAvalonia.Extensions"
             xmlns:valueType="clr-namespace:MFAAvalonia.Helper.ValueType"
             xmlns:maa="clr-namespace:MFAAvalonia.Extensions.MaaFW"
             xmlns:markup="https://codewf.com"
             xmlns:controls="clr-namespace:MFAAvalonia.Views.UserControls"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:mdxaml="https://github.com/whistyun/Markdown.Avalonia"
             xmlns:pages="clr-namespace:MFAAvalonia.ViewModels.Pages"
             xmlns:suki="https://github.com/kikipoulet/SukiUI"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:behaviors="using:Avalonia.Xaml.Interactions.Core"
             xmlns:interaction="using:Avalonia.Xaml.Interactivity"
             xmlns:avalonia="https://github.com/whistyun/Markdown.Avalonia.Tight"
             xmlns:helper="clr-namespace:MFAAvalonia.Helper"
             xmlns:avalonia1="clr-namespace:FluentIcons.Avalonia;assembly=FluentIcons.Avalonia"
             xmlns:fluent="clr-namespace:FluentIcons.Avalonia.Fluent;assembly=FluentIcons.Avalonia.Fluent"
             xmlns:other="clr-namespace:MFAAvalonia.ViewModels.Other"
             xmlns:dashboard="clr-namespace:MFAAvalonia.Views.UserControls.Dashboard">
    <Design.DataContext>
        <pages:TaskQueueViewModel />
    </Design.DataContext>
    <UserControl.Resources>
        <ContextMenu x:Key="TaskMenu">
            <MenuItem IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                      Click="RunSingleTask"
                      Header="{markup:I18n {x:Static helper:LangKeys.RunSingle}}" />
            <MenuItem IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                      Click="RunCheckedFromCurrent"
                      Header="{markup:I18n {x:Static helper:LangKeys.RunCheckedFromCurrent}}" />
            <MenuItem Click="Delete"
                      Header="{markup:I18n {x:Static helper:LangKeys.Delete}}" />
        </ContextMenu>
    </UserControl.Resources>
    <UserControl.Styles>
        <Style Selector="Button.SyncButton Path">
            <Setter Property="RenderTransformOrigin" Value="50%,50%" />
            <Setter Property="Margin" Value="1" />
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <TransformGroup>
                        <ScaleTransform ScaleX="1" ScaleY="1" />
                        <RotateTransform Angle="0" />
                    </TransformGroup>
                </Setter.Value>
            </Setter>
        </Style>
        <Style Selector="Button.SyncButton:pointerover Path">
            <Style.Animations>
                <Animation Duration="0:0:0.15" FillMode="Forward">
                    <KeyFrame Cue="100%">
                        <Setter Property="ScaleTransform.ScaleX" Value="1.1" />
                        <Setter Property="ScaleTransform.ScaleY" Value="1.1" />
                        <Setter Property="RotateTransform.Angle" Value="-15" />
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>
        <Style Selector="Button.SyncButton:not(:pointerover) Path">
            <Style.Animations>
                <Animation Duration="0:0:0.15" FillMode="Forward">
                    <KeyFrame Cue="100%">
                        <Setter Property="ScaleTransform.ScaleX" Value="1" />
                        <Setter Property="ScaleTransform.ScaleY" Value="1" />
                        <Setter Property="RotateTransform.Angle" Value="0" />
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>
        <Style Selector="Button.SyncButton:pressed Path">
            <Style.Animations>
                <Animation Duration="0:0:0.6" FillMode="Forward">
                    <KeyFrame Cue="0%">
                        <Setter Property="RotateTransform.Angle" Value="0" />
                    </KeyFrame>
                    <KeyFrame Cue="100%">
                        <Setter Property="RotateTransform.Angle" Value="360" />
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>


        <!-- 中心绿点脉冲动画 -->
        <Style Selector="Ellipse#LiveStatusDot">
            <Style.Animations>
                <Animation Duration="0:0:1.5" IterationCount="INFINITE" Easing="CubicEaseInOut">
                    <KeyFrame Cue="0%">
                        <Setter Property="ScaleTransform.ScaleX" Value="1" />
                        <Setter Property="ScaleTransform.ScaleY" Value="1" />
                        <Setter Property="Opacity" Value="1" />
                    </KeyFrame>
                    <KeyFrame Cue="50%">
                        <Setter Property="ScaleTransform.ScaleX" Value="1.2" />
                        <Setter Property="ScaleTransform.ScaleY" Value="1.2" />
                        <Setter Property="Opacity" Value="0.8" />
                    </KeyFrame>
                    <KeyFrame Cue="100%">
                        <Setter Property="ScaleTransform.ScaleX" Value="1" />
                        <Setter Property="ScaleTransform.ScaleY" Value="1" />
                        <Setter Property="Opacity" Value="1" />
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>

        <!-- 外圈扩散动画 1 -->
        <Style Selector="Ellipse#PulseRing1">
            <Style.Animations>
                <Animation Duration="0:0:1.5" IterationCount="INFINITE" Easing="CubicEaseOut">
                    <KeyFrame Cue="0%">
                        <Setter Property="ScaleTransform.ScaleX" Value="1" />
                        <Setter Property="ScaleTransform.ScaleY" Value="1" />
                        <Setter Property="Opacity" Value="0.6" />
                        <Setter Property="StrokeThickness" Value="2" />
                    </KeyFrame>
                    <KeyFrame Cue="100%">
                        <Setter Property="ScaleTransform.ScaleX" Value="2.5" />
                        <Setter Property="ScaleTransform.ScaleY" Value="2.5" />
                        <Setter Property="Opacity" Value="0" />
                        <Setter Property="StrokeThickness" Value="0.5" />
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>

        <!-- 外圈扩散动画 2 (延迟 0.75s) -->
        <Style Selector="Ellipse#PulseRing2">
            <Style.Animations>
                <Animation Duration="0:0:1.5" IterationCount="INFINITE" Easing="CubicEaseOut" Delay="0:0:0.75">
                    <KeyFrame Cue="0%">
                        <Setter Property="ScaleTransform.ScaleX" Value="1" />
                        <Setter Property="ScaleTransform.ScaleY" Value="1" />
                        <Setter Property="Opacity" Value="0.6" />
                        <Setter Property="StrokeThickness" Value="2" />
                    </KeyFrame>
                    <KeyFrame Cue="100%">
                        <Setter Property="ScaleTransform.ScaleX" Value="2.5" />
                        <Setter Property="ScaleTransform.ScaleY" Value="2.5" />
                        <Setter Property="Opacity" Value="0" />
                        <Setter Property="StrokeThickness" Value="0.5" />
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>


        <!-- TaskToggle 外层悬停放大 -->
        <Style Selector="Border#TaskToggleBorder, Border#TaskToggleBorder1">
            <Setter Property="RenderTransformOrigin" Value="50%,50%" />
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <ScaleTransform ScaleX="1" ScaleY="1" />
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style Selector="Border#TaskToggleBorder:pointerover, Border#TaskToggleBorder1:pointerover">
            <Setter Property="RenderTransform">
                <ScaleTransform ScaleX="1.12" ScaleY="1.12" />
            </Setter>
            <Setter Property="Background" Value="{DynamicResource SukiPrimaryColor75}" />
        </Style>

        <!-- 单层流光动画 -->
        <Style Selector="Border#TaskToggleShineLayer, Border#TaskToggleShineLayer1">
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <TranslateTransform X="-160" />
                </Setter.Value>
            </Setter>
            <Style.Animations>
                <Animation Duration="0:0:1.8" IterationCount="INFINITE">
                    <KeyFrame Cue="0%">
                        <Setter Property="TranslateTransform.X" Value="-160" />
                    </KeyFrame>
                    <KeyFrame Cue="100%">
                        <Setter Property="TranslateTransform.X" Value="160" />
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>

        <!-- BasicTight 悬停放大与前景变浅 -->
        <Style Selector="Button.TaskQueueBasicTight">
            <Setter Property="RenderTransformOrigin" Value="50%,50%" />
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <ScaleTransform ScaleX="1" ScaleY="1" />
                </Setter.Value>
            </Setter>
        </Style>

        <Style Selector="Button.TaskQueueBasicTight:pointerover">
            <Setter Property="RenderTransform">
                <ScaleTransform ScaleX="1.2" ScaleY="1.2" />
            </Setter>
            <Setter Property="Foreground" Value="{DynamicResource SukiPrimaryColor75}" />
        </Style>

        <Style Selector="Button.PlayStopButton:pointerover">
            <Style.Animations>
                <Animation Duration="0:0:0.15" FillMode="Forward">
                    <KeyFrame Cue="100%">
                        <Setter Property="ScaleTransform.ScaleX" Value="1.15" />
                        <Setter Property="ScaleTransform.ScaleY" Value="1.15" />
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>

        <Style Selector="Button.PlayStopButton:not(:pointerover)">
            <Style.Animations>
                <Animation Duration="0:0:0.15" FillMode="Forward">
                    <KeyFrame Cue="100%">
                        <Setter Property="ScaleTransform.ScaleX" Value="1" />
                        <Setter Property="ScaleTransform.ScaleY" Value="1" />
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>

        <Style Selector="Border#GradientButtonBorder:pointerover Border#ShineLayer1">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                        <GradientStop Color="Transparent" Offset="0.0" />
                        <GradientStop Color="Transparent" Offset="0.25" />
                        <GradientStop Color="#40FFFFFF" Offset="0.45" />
                        <GradientStop Color="#70FFFFFF" Offset="0.5" />
                        <GradientStop Color="#40FFFFFF" Offset="0.55" />
                        <GradientStop Color="Transparent" Offset="0.75" />
                        <GradientStop Color="Transparent" Offset="1.0" />
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
        </Style>
        <Style Selector="Border#GradientButtonBorder:pointerover Border#ShineLayer2">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                        <GradientStop Color="Transparent" Offset="0.0" />
                        <GradientStop Color="Transparent" Offset="0.25" />
                        <GradientStop Color="#40FFFFFF" Offset="0.45" />
                        <GradientStop Color="#70FFFFFF" Offset="0.5" />
                        <GradientStop Color="#40FFFFFF" Offset="0.55" />
                        <GradientStop Color="Transparent" Offset="0.75" />
                        <GradientStop Color="Transparent" Offset="1.0" />
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
        </Style>
        <Style Selector="Border#GradientButtonBorder:pointerover Border#ShineLayer3">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                        <GradientStop Color="Transparent" Offset="0.0" />
                        <GradientStop Color="Transparent" Offset="0.25" />
                        <GradientStop Color="#40FFFFFF" Offset="0.45" />
                        <GradientStop Color="#70FFFFFF" Offset="0.5" />
                        <GradientStop Color="#40FFFFFF" Offset="0.55" />
                        <GradientStop Color="Transparent" Offset="0.75" />
                        <GradientStop Color="Transparent" Offset="1.0" />
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Styles>


    <!-- 主布局：两行结构 -->
    <Grid ClipToBounds="False" Margin="0,0,0,0" RowDefinitions="Auto,*" x:Name="MainGrid">

        <!-- 第一行：顶部工具栏（资源选择 + 连接设置） -->
        <suki:GlassCard Grid.Row="0" Margin="15,15,15,5" Padding="12,8" IsAnimated="False">
            <Grid x:Name="TopToolbar">
                <Grid x:Name="TopToolbarWide">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <!-- 在 TopToolbar Grid 中添加新列，放在资源选择之前 -->
                    <Grid x:Name="ConfigSelectorPanel" Grid.Column="0" VerticalAlignment="Center"
                          ColumnDefinitions="Auto,*">
                        <TextBlock FontSize="12" Grid.Column="0"
                                   FontWeight="Bold" Foreground="{DynamicResource SukiLowText}"
                                   Text="{markup:I18n {x:Static helper:LangKeys.CurrentConfig}}"
                                   VerticalAlignment="Center" />
                        <ComboBox Margin="8 0 0 0" Grid.Column="1"
                                  ex:ComboBoxExtensions.DisableNavigationOnLostFocus="True"
                                  IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                                  ItemsSource="{Binding ConfigurationList}"
                                  SelectedValue="{Binding CurrentConfiguration}"
                                  SelectedValueBinding="{Binding Name}"
                                  MinWidth="120">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Name}" TextTrimming="CharacterEllipsis" />
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>

                    </Grid>
                    <!-- ~1~ 添加分隔符 @1@ -->
                    <Border x:Name="Spliter1" Grid.Column="1" Width="1" Height="30"
                            Background="{DynamicResource SukiControlBorderBrush}" Margin="20,0" />

                    <!-- 左侧：资源选择 -->
                    <Grid x:Name="ResourceSelectorPanel" Grid.Column="2" VerticalAlignment="Center"
                          ColumnDefinitions="Auto,*">
                        <TextBlock FontSize="12" Grid.Column="0"
                                   FontWeight="Bold" Foreground="{DynamicResource SukiLowText}"
                                   Text="{markup:I18n {x:Static helper:LangKeys.ResourceOption}}"
                                   VerticalAlignment="Center" />
                        <ComboBox Margin="8 0 0 0" Grid.Column="1"
                                  ex:ComboBoxExtensions.DisableNavigationOnLostFocus="True"
                                  IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                                  ItemsSource="{Binding CurrentResources}"
                                  MinWidth="150" HorizontalAlignment="Stretch"
                                  SelectedValue="{Binding CurrentResource, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                  SelectedValueBinding="{Binding Name}" VerticalAlignment="Center">
                            <ComboBox.ItemTemplate>
                                <DataTemplate x:DataType="maa:MaaInterface+MaaInterfaceResource">
                                    <Grid ColumnDefinitions="Auto,*,Auto">
                                        <controls:DisplayIcon Grid.Column="0" IconSource="{Binding ResolvedIcon}"
                                                              IconSize="20" IsVisible="{Binding HasIcon}"
                                                              Margin="0,0,6,0"
                                                              VerticalAlignment="Center" />
                                        <TextBlock Background="Transparent" Foreground="{DynamicResource SukiText}"
                                                   Grid.Column="1"
                                                   Text="{Binding DisplayName}"
                                                   TextTrimming="CharacterEllipsis"
                                                   VerticalAlignment="Center" />
                                        <controls:TooltipBlock MaxWidth="40" Grid.Column="2"
                                                               IsVisible="{Binding HasDescription}"
                                                               TooltipText="{Binding DisplayDescription}" />
                                    </Grid>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                            <ComboBox.SelectionBoxItemTemplate>
                                <DataTemplate>
                                    <Grid ColumnDefinitions="Auto,*,Auto">
                                        <controls:DisplayIcon Grid.Column="0" IconSource="{Binding ResolvedIcon}"
                                                              IconSize="20" IsVisible="{Binding HasIcon}"
                                                              Margin="0,0,6,0"
                                                              VerticalAlignment="Center" />
                                        <TextBlock Background="Transparent" Foreground="{DynamicResource SukiText}"
                                                   Grid.Column="1"
                                                   Text="{Binding DisplayName}"
                                                   TextTrimming="CharacterEllipsis"
                                                   VerticalAlignment="Center" />
                                        <controls:TooltipBlock MaxWidth="40" Grid.Column="2"
                                                               IsVisible="{Binding HasDescription}"
                                                               TooltipText="{Binding DisplayDescription}" />
                                    </Grid>
                                </DataTemplate>
                            </ComboBox.SelectionBoxItemTemplate>
                        </ComboBox>
                    </Grid>

                    <!-- 中间：分隔符 -->
                    <Border Grid.Column="3" Width="1" Height="30" Background="{DynamicResource SukiControlBorderBrush}"
                            x:Name="Spliter2"
                            Margin="20,0" />
                    <!-- 控制器类型选择 -->
                    <Grid x:Name="ControllerSelectorPanel" Grid.Column="4" VerticalAlignment="Center"
                          ColumnDefinitions="Auto,*">
                        <TextBlock Grid.Column="0" FontSize="12"
                                   FontWeight="Bold" Foreground="{DynamicResource SukiLowText}"
                                   Text="{markup:I18n {x:Static helper:LangKeys.ControllerType}}"
                                   VerticalAlignment="Center" />
                        <ComboBox Margin="8 0 0 0" Grid.Column="1" x:Name="ControllerComboBox"
                                  ex:ComboBoxExtensions.DisableNavigationOnLostFocus="True"
                                  IsEnabled="{calcBinding:Binding '!LockController and Idle',Source={x:Static helper:Instances.RootViewModel}}"
                                  ItemsSource="{Binding ControllerOptions}"
                                  SelectedItem="{Binding SelectedController, Mode=TwoWay}"
                                  MinWidth="120" VerticalAlignment="Center">
                            <ComboBox.ItemTemplate>
                                <DataTemplate x:DataType="maa:MaaInterface+MaaResourceController">
                                    <Grid ColumnDefinitions="Auto,*,Auto">
                                        <controls:DisplayIcon Grid.Column="0" IconSource="{Binding ResolvedIcon}"
                                                              IconSize="20" IsVisible="{Binding HasIcon}"
                                                              Margin="0,0,6,0"
                                                              VerticalAlignment="Center" />
                                        <TextBlock Background="Transparent" Foreground="{DynamicResource SukiText}"
                                                   Grid.Column="1"
                                                   Text="{Binding DisplayName}"
                                                   TextTrimming="CharacterEllipsis"
                                                   VerticalAlignment="Center" />
                                        <controls:TooltipBlock MaxWidth="40" Grid.Column="2"
                                                               IsVisible="{Binding HasDescription}"
                                                               TooltipText="{Binding DisplayDescription}" />
                                    </Grid>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                            <ComboBox.SelectionBoxItemTemplate>
                                <DataTemplate>
                                    <Grid ColumnDefinitions="Auto,*,Auto">
                                        <controls:DisplayIcon Grid.Column="0" IconSource="{Binding ResolvedIcon}"
                                                              IconSize="20" IsVisible="{Binding HasIcon}"
                                                              Margin="0,0,6,0"
                                                              VerticalAlignment="Center" />
                                        <TextBlock Background="Transparent" Foreground="{DynamicResource SukiText}"
                                                   Grid.Column="1"
                                                   Text="{Binding DisplayName}"
                                                   TextTrimming="CharacterEllipsis"
                                                   VerticalAlignment="Center" />
                                        <controls:TooltipBlock MaxWidth="40" Grid.Column="2"
                                                               IsVisible="{Binding HasDescription}"
                                                               TooltipText="{Binding DisplayDescription}" />
                                    </Grid>
                                </DataTemplate>
                            </ComboBox.SelectionBoxItemTemplate>
                        </ComboBox>
                    </Grid>
                    <!-- 右侧：连接设置 -->
                    <Grid x:Name="DeviceSelectorPanel" Grid.Column="5" HorizontalAlignment="Stretch"
                          MinWidth="200"
                          IsVisible="{calcBinding:Binding 'CurrentController != maa:MaaControllerTypes.PlayCover'}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" x:Name="DeviceSelectorLabel"
                                   FontSize="12" Margin="8 0"
                                   FontWeight="Bold" Foreground="{DynamicResource SukiLowText}"
                                   Text="{markup:I18n {x:Static helper:LangKeys.CurrentController}}"
                                   VerticalAlignment="Center" />
                        <ComboBox Grid.Column="1" x:Name="DeviceComboBox"
                                  ex:ComboBoxExtensions.DisableNavigationOnLostFocus="True"
                                  Classes="LimitWidth" Height="35"
                                  IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                                  ItemsSource="{Binding Devices}"
                                  MinWidth="100"
                                  HorizontalAlignment="Stretch"
                                  SelectedValue="{Binding CurrentDevice, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            <ToolTip.Tip>
                                <TextBlock
                                    Text="{Binding CurrentDevice, Converter={converters:DeviceDisplayConverter}}" />
                            </ToolTip.Tip>
                            <ComboBox.DataTemplates>
                                <DataTemplate DataType="binding:AdbDeviceInfo">
                                    <TextBlock HorizontalAlignment="Left"
                                               Text="{Binding Converter={converters:DeviceDisplayConverter}}" />
                                </DataTemplate>
                                <DataTemplate DataType="binding:DesktopWindowInfo">
                                    <TextBlock HorizontalAlignment="Left"
                                               Text="{Binding Name}" />
                                </DataTemplate>
                            </ComboBox.DataTemplates>
                        </ComboBox>
                    </Grid>
                    <StackPanel x:Name="ConnectionButtonsPanel" Grid.Column="6" Orientation="Horizontal"
                                VerticalAlignment="Center" Spacing="4">
                        <StackPanel.Resources>
                            <markup:IfConditionConverter x:Key="ConnectedConditionConverter">
                                <markup:IfConditionConverter.True>
                                    <Path Data="{StaticResource ConnectedGeometry}" Fill="LimeGreen"
                                          Height="11" Margin="3,2,4,0" Stretch="Uniform"
                                          ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.Connected}}" />
                                </markup:IfConditionConverter.True>
                                <markup:IfConditionConverter.False>
                                    <Path Data="{StaticResource UnconnectedGeometry}" Fill="Red"
                                          Height="16" Margin="3,3,4,0" Stretch="Uniform"
                                          ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.Unconnected}}"
                                          VerticalAlignment="Center" />
                                </markup:IfConditionConverter.False>
                            </markup:IfConditionConverter>
                        </StackPanel.Resources>
                        <Button Classes="BasicTight TaskQueueBasicTight"
                                ClipToBounds="False"
                                Command="{Binding CustomAdbCommand}"
                                IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                                IsVisible="{calcBinding:Binding 'CurrentController == maa:MaaControllerTypes.Adb'}"
                                Padding="0" ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.Custom}}">
                            <avalonia1:FluentIcon Height="18" Icon="DesktopEdit" IconSize="Size16"
                                                  IconVariant="Regular" />
                        </Button>
                        <Button Classes="BasicTight TaskQueueBasicTight"
                                Command="{Binding EditPlayCoverCommand}"
                                IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                                IsVisible="{calcBinding:Binding 'CurrentController == maa:MaaControllerTypes.PlayCover'}"
                                Padding="0"
                                ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.EditControllerConfiguration}}">
                            <avalonia1:FluentIcon Height="18" Icon="DesktopEdit" IconSize="Size16"
                                                  IconVariant="Regular" />
                        </Button>
                        <Button Classes="BasicTight TaskQueueBasicTight"
                                Command="{Binding ReconnectCommand}"
                                IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                                Padding="0"
                                Width="24"
                                Height="24"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"
                                ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.Reconnect}}"
                                VerticalAlignment="Center">
                            <Path Data="{StaticResource LinkGeometry}"
                                  Width="16"
                                  Height="16"
                                  Stretch="Uniform"
                                  Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" />
                        </Button>
                        <Button Classes="BasicTight TaskQueueBasicTight SyncButton"
                                ClipToBounds="False"
                                Command="{Binding RefreshCommand}"
                                IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                                Padding="0"
                                Width="24"
                                IsVisible="{calcBinding:Binding 'CurrentController != maa:MaaControllerTypes.PlayCover'}"
                                Height="24"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"
                                ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.TooltipRefresh}}"
                                VerticalAlignment="Center">
                            <Path Data="{StaticResource RefreshGeometry}"
                                  Width="16"
                                  Height="16"
                                  Stretch="Uniform"
                                  Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" />
                        </Button>
                        <ContentControl
                            Content="{Binding IsConnected, Converter={StaticResource ConnectedConditionConverter}, Source={x:Static helper:Instances.TaskQueueViewModel}}" />
                        <Border x:Name="TaskToggleBorder" Height="30"
                                CornerRadius="999"
                                ClipToBounds="True"
                                Margin="2,0,0,0"
                                Background="{DynamicResource SukiPrimaryColor}">
                            <Grid>
                                <Border x:Name="TaskToggleShineLayer"
                                        Width="{Binding Bounds.Width, ElementName=TaskToggleBorder}"
                                        CornerRadius="999"
                                        IsHitTestVisible="False"
                                        HorizontalAlignment="Left">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                                            <GradientStop Color="Transparent" Offset="0.0" />
                                            <GradientStop Color="Transparent" Offset="0.25" />
                                            <GradientStop Color="#25FFFFFF" Offset="0.45" />
                                            <GradientStop Color="#50FFFFFF" Offset="0.5" />
                                            <GradientStop Color="#25FFFFFF" Offset="0.55" />
                                            <GradientStop Color="Transparent" Offset="0.75" />
                                            <GradientStop Color="Transparent" Offset="1.0" />
                                        </LinearGradientBrush>
                                    </Border.Background>
                                </Border>
                                <Button Classes="Flat Rounded"
                                        IsEnabled="{Binding ToggleEnable}"
                                        Command="{Binding ToggleCommand}"
                                        Padding="0,0"
                                        CornerRadius="999"
                                        Background="Transparent"
                                        Foreground="White">
                                    <Grid Margin="12 2">
                                        <WrapPanel
                                            IsVisible="{Binding !IsRunning, Source={x:Static helper:Instances.RootViewModel}}">
                                            <Path Data="{StaticResource PlayGeometry}"
                                                  Fill="White"
                                                  Width="12"
                                                  Height="12"
                                                  Stretch="Uniform"
                                                  VerticalAlignment="Center"
                                                  HorizontalAlignment="Center" />
                                            <TextBlock Margin="6 0 0 0" FontSize="12"
                                                       Text="{markup:I18n {x:Static helper:LangKeys.StartTask}}" />
                                        </WrapPanel>
                                        <WrapPanel
                                            IsVisible="{Binding IsRunning, Source={x:Static helper:Instances.RootViewModel}}">
                                            <Path Data="{StaticResource StopGeometry}"
                                                  Fill="White"
                                                  Width="12"
                                                  Height="12"
                                                  Stretch="Uniform"
                                                  VerticalAlignment="Center"
                                                  HorizontalAlignment="Center" />
                                            <TextBlock Margin="6 0 0 0" FontSize="12"
                                                       Text="{markup:I18n {x:Static helper:LangKeys.StopTask}}" />
                                        </WrapPanel>
                                    </Grid>
                                </Button>
                            </Grid>
                        </Border>
                    </StackPanel>
                </Grid>
                <Grid x:Name="TopToolbarCompact" IsVisible="False" RowDefinitions="Auto,Auto">
                    <Grid x:Name="TopToolbarCompactRow1" Grid.Row="0" ColumnDefinitions="*,Auto,*,Auto">
                        <Grid x:Name="ConfigSelectorPanelCompact" Grid.Column="0" VerticalAlignment="Center"
                              ColumnDefinitions="Auto,*">
                            <TextBlock FontSize="12" Grid.Column="0"
                                       FontWeight="Bold" Foreground="{DynamicResource SukiLowText}"
                                       Text="{markup:I18n {x:Static helper:LangKeys.CurrentConfig}}"
                                       VerticalAlignment="Center" />
                            <ComboBox Margin="8 0 0 0" Grid.Column="1"
                                      ex:ComboBoxExtensions.DisableNavigationOnLostFocus="True"
                                      IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                                      ItemsSource="{Binding ConfigurationList}"
                                      SelectedValue="{Binding CurrentConfiguration}"
                                      SelectedValueBinding="{Binding Name}"
                                      MinWidth="120">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}" TextTrimming="CharacterEllipsis" />
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </Grid>

                        <Border x:Name="Spliter1Compact" Grid.Column="1" Width="1" Height="30"
                                Background="{DynamicResource SukiControlBorderBrush}" Margin="20,0" />

                        <Grid x:Name="ResourceSelectorPanelCompact" Grid.Column="2" VerticalAlignment="Center"
                              ColumnDefinitions="Auto,*">
                            <TextBlock FontSize="12" Grid.Column="0"
                                       FontWeight="Bold" Foreground="{DynamicResource SukiLowText}"
                                       Text="{markup:I18n {x:Static helper:LangKeys.ResourceOption}}"
                                       VerticalAlignment="Center" />
                            <ComboBox Margin="8 0 0 0" Grid.Column="1"
                                      ex:ComboBoxExtensions.DisableNavigationOnLostFocus="True"
                                      IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                                      ItemsSource="{Binding CurrentResources}"
                                      MinWidth="150" HorizontalAlignment="Stretch"
                                      SelectedValue="{Binding CurrentResource, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                      SelectedValueBinding="{Binding Name}" VerticalAlignment="Center">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate x:DataType="maa:MaaInterface+MaaInterfaceResource">
                                        <Grid ColumnDefinitions="Auto,*,Auto">
                                            <controls:DisplayIcon Grid.Column="0" IconSource="{Binding ResolvedIcon}"
                                                                  IconSize="20" IsVisible="{Binding HasIcon}"
                                                                  Margin="0,0,6,0"
                                                                  VerticalAlignment="Center" />
                                            <TextBlock Background="Transparent" Foreground="{DynamicResource SukiText}"
                                                       Grid.Column="1"
                                                       Text="{Binding DisplayName}"
                                                       TextTrimming="CharacterEllipsis"
                                                       VerticalAlignment="Center" />
                                            <controls:TooltipBlock MaxWidth="40" Grid.Column="2"
                                                                   IsVisible="{Binding HasDescription}"
                                                                   TooltipText="{Binding DisplayDescription}" />
                                        </Grid>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                                <ComboBox.SelectionBoxItemTemplate>
                                    <DataTemplate>
                                        <Grid ColumnDefinitions="Auto,*,Auto">
                                            <controls:DisplayIcon Grid.Column="0" IconSource="{Binding ResolvedIcon}"
                                                                  IconSize="20" IsVisible="{Binding HasIcon}"
                                                                  Margin="0,0,6,0"
                                                                  VerticalAlignment="Center" />
                                            <TextBlock Background="Transparent" Foreground="{DynamicResource SukiText}"
                                                       Grid.Column="1"
                                                       Text="{Binding DisplayName}"
                                                       TextTrimming="CharacterEllipsis"
                                                       VerticalAlignment="Center" />
                                            <controls:TooltipBlock MaxWidth="40" Grid.Column="2"
                                                                   IsVisible="{Binding HasDescription}"
                                                                   TooltipText="{Binding DisplayDescription}" />
                                        </Grid>
                                    </DataTemplate>
                                </ComboBox.SelectionBoxItemTemplate>
                            </ComboBox>
                        </Grid>

                        <Border Grid.Column="3" x:Name="TaskToggleBorder1"
                                CornerRadius="999"
                                ClipToBounds="True" Height="30"
                                Margin="2,0,0,0"
                                Background="{DynamicResource SukiPrimaryColor}">
                            <Grid>
                                <Border x:Name="TaskToggleShineLayer1"
                                        Width="{Binding Bounds.Width, ElementName=TaskToggleBorder1}"
                                        CornerRadius="999"
                                        IsHitTestVisible="False"
                                        HorizontalAlignment="Left">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                                            <GradientStop Color="Transparent" Offset="0.0" />
                                            <GradientStop Color="Transparent" Offset="0.25" />
                                            <GradientStop Color="#25FFFFFF" Offset="0.45" />
                                            <GradientStop Color="#50FFFFFF" Offset="0.5" />
                                            <GradientStop Color="#25FFFFFF" Offset="0.55" />
                                            <GradientStop Color="Transparent" Offset="0.75" />
                                            <GradientStop Color="Transparent" Offset="1.0" />
                                        </LinearGradientBrush>
                                    </Border.Background>
                                </Border>
                                <Button Classes="Flat Rounded"
                                        IsEnabled="{Binding ToggleEnable}"
                                        Command="{Binding ToggleCommand}"
                                        Padding="0,0"
                                        CornerRadius="999"
                                        Background="Transparent"
                                        Foreground="White">
                                    <Grid Margin="12 2">
                                        <WrapPanel
                                            IsVisible="{Binding !IsRunning, Source={x:Static helper:Instances.RootViewModel}}">
                                            <Path Data="{StaticResource PlayGeometry}"
                                                  Fill="White"
                                                  Width="12"
                                                  Height="12"
                                                  Stretch="Uniform"
                                                  VerticalAlignment="Center"
                                                  HorizontalAlignment="Center" />
                                            <TextBlock Margin="6 0 0 0" FontSize="12"
                                                       Text="{markup:I18n {x:Static helper:LangKeys.StartTask}}" />
                                        </WrapPanel>
                                        <WrapPanel
                                            IsVisible="{Binding IsRunning, Source={x:Static helper:Instances.RootViewModel}}">
                                            <Path Data="{StaticResource StopGeometry}"
                                                  Fill="White"
                                                  Width="12"
                                                  Height="12"
                                                  Stretch="Uniform"
                                                  VerticalAlignment="Center"
                                                  HorizontalAlignment="Center" />
                                            <TextBlock Margin="6 0 0 0" FontSize="12"
                                                       Text="{markup:I18n {x:Static helper:LangKeys.StopTask}}" />
                                        </WrapPanel>
                                    </Grid>
                                </Button>
                            </Grid>
                        </Border>
                    </Grid>
                    <Grid x:Name="TopToolbarCompactRow2" Grid.Row="1" Margin="0,6,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Grid x:Name="ControllerSelectorPanelCompact" Grid.Column="0" VerticalAlignment="Center"
                              ColumnDefinitions="Auto,*">
                            <TextBlock Grid.Column="0" FontSize="12"
                                       FontWeight="Bold" Foreground="{DynamicResource SukiLowText}"
                                       Text="{markup:I18n {x:Static helper:LangKeys.ControllerType}}"
                                       VerticalAlignment="Center" />
                            <ComboBox Margin="8 0 0 0" Grid.Column="1"
                                      ex:ComboBoxExtensions.DisableNavigationOnLostFocus="True"
                                      IsEnabled="{calcBinding:Binding '!LockController and Idle',Source={x:Static helper:Instances.RootViewModel}}"
                                      ItemsSource="{Binding ControllerOptions}"
                                      SelectedItem="{Binding SelectedController, Mode=TwoWay}"
                                      MinWidth="120" VerticalAlignment="Center">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate x:DataType="maa:MaaInterface+MaaResourceController">
                                        <Grid ColumnDefinitions="Auto,*,Auto">
                                            <controls:DisplayIcon Grid.Column="0" IconSource="{Binding ResolvedIcon}"
                                                                  IconSize="20" IsVisible="{Binding HasIcon}"
                                                                  Margin="0,0,6,0"
                                                                  VerticalAlignment="Center" />
                                            <TextBlock Background="Transparent" Foreground="{DynamicResource SukiText}"
                                                       Grid.Column="1"
                                                       Text="{Binding DisplayName}"
                                                       TextTrimming="CharacterEllipsis"
                                                       VerticalAlignment="Center" />
                                            <controls:TooltipBlock MaxWidth="40" Grid.Column="2"
                                                                   IsVisible="{Binding HasDescription}"
                                                                   TooltipText="{Binding DisplayDescription}" />
                                        </Grid>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                                <ComboBox.SelectionBoxItemTemplate>
                                    <DataTemplate>
                                        <Grid ColumnDefinitions="Auto,*,Auto">
                                            <controls:DisplayIcon Grid.Column="0" IconSource="{Binding ResolvedIcon}"
                                                                  IconSize="20" IsVisible="{Binding HasIcon}"
                                                                  Margin="0,0,6,0"
                                                                  VerticalAlignment="Center" />
                                            <TextBlock Background="Transparent" Foreground="{DynamicResource SukiText}"
                                                       Grid.Column="1"
                                                       Text="{Binding DisplayName}"
                                                       TextTrimming="CharacterEllipsis"
                                                       VerticalAlignment="Center" />
                                            <controls:TooltipBlock MaxWidth="40" Grid.Column="2"
                                                                   IsVisible="{Binding HasDescription}"
                                                                   TooltipText="{Binding DisplayDescription}" />
                                        </Grid>
                                    </DataTemplate>
                                </ComboBox.SelectionBoxItemTemplate>
                            </ComboBox>
                        </Grid>

                        <Border x:Name="Spliter2Compact" Grid.Column="1" Width="1" Height="30"
                                Background="{DynamicResource SukiControlBorderBrush}" Margin="20,0" />

                        <Grid x:Name="DeviceSelectorPanelCompact" Grid.Column="2" HorizontalAlignment="Stretch"
                              MinWidth="200"
                              IsVisible="{calcBinding:Binding 'CurrentController != maa:MaaControllerTypes.PlayCover'}"
                              ColumnDefinitions="Auto,*">
                            <TextBlock Grid.Column="0"
                                       FontSize="12" Margin="8 0"
                                       FontWeight="Bold" Foreground="{DynamicResource SukiLowText}"
                                       Text="{markup:I18n {x:Static helper:LangKeys.CurrentController}}"
                                       VerticalAlignment="Center" />
                            <ComboBox Grid.Column="1"
                                      ex:ComboBoxExtensions.DisableNavigationOnLostFocus="True"
                                      Classes="LimitWidth" Height="35"
                                      IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                                      ItemsSource="{Binding Devices}"
                                      MinWidth="100"
                                      HorizontalAlignment="Stretch"
                                      SelectedValue="{Binding CurrentDevice, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                <ToolTip.Tip>
                                    <TextBlock
                                        Text="{Binding CurrentDevice, Converter={converters:DeviceDisplayConverter}}" />
                                </ToolTip.Tip>
                                <ComboBox.DataTemplates>
                                    <DataTemplate DataType="binding:AdbDeviceInfo">
                                        <TextBlock HorizontalAlignment="Left"
                                                   Text="{Binding Converter={converters:DeviceDisplayConverter}}" />
                                    </DataTemplate>
                                    <DataTemplate DataType="binding:DesktopWindowInfo">
                                        <TextBlock HorizontalAlignment="Left"
                                                   Text="{Binding Name}" />
                                    </DataTemplate>
                                </ComboBox.DataTemplates>
                            </ComboBox>
                        </Grid>

                        <StackPanel x:Name="ConnectionButtonsPanelCompact" Grid.Column="3" Orientation="Horizontal"
                                    VerticalAlignment="Center" Spacing="4">
                            <StackPanel.Resources>
                                <markup:IfConditionConverter x:Key="ConnectedConditionConverterCompact">
                                    <markup:IfConditionConverter.True>
                                        <Path Data="{StaticResource ConnectedGeometry}" Fill="LimeGreen"
                                              Height="11" Margin="3,2,4,0" Stretch="Uniform"
                                              ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.Connected}}" />
                                    </markup:IfConditionConverter.True>
                                    <markup:IfConditionConverter.False>
                                        <Path Data="{StaticResource UnconnectedGeometry}" Fill="Red"
                                              Height="16" Margin="3,3,4,0" Stretch="Uniform"
                                              ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.Unconnected}}"
                                              VerticalAlignment="Center" />
                                    </markup:IfConditionConverter.False>
                                </markup:IfConditionConverter>
                            </StackPanel.Resources>
                            <Button Classes="BasicTight TaskQueueBasicTight"
                                    ClipToBounds="False"
                                    Command="{Binding CustomAdbCommand}"
                                    IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                                    IsVisible="{calcBinding:Binding 'CurrentController == maa:MaaControllerTypes.Adb'}"
                                    Padding="0" ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.Custom}}">
                                <avalonia1:FluentIcon Height="18" Icon="DesktopEdit" IconSize="Size16"
                                                      IconVariant="Regular" />
                            </Button>
                            <Button Classes="BasicTight TaskQueueBasicTight"
                                    Command="{Binding EditPlayCoverCommand}"
                                    IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                                    IsVisible="{calcBinding:Binding 'CurrentController == maa:MaaControllerTypes.PlayCover'}"
                                    Padding="0"
                                    ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.EditControllerConfiguration}}">
                                <avalonia1:FluentIcon Height="18" Icon="DesktopEdit" IconSize="Size16"
                                                      IconVariant="Regular" />
                            </Button>
                            <Button Classes="BasicTight TaskQueueBasicTight"
                                    Command="{Binding ReconnectCommand}"
                                    IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                                    Padding="0"
                                    Width="24"
                                    Height="24"
                                    HorizontalContentAlignment="Center"
                                    VerticalContentAlignment="Center"
                                    ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.Reconnect}}"
                                    VerticalAlignment="Center">
                                <Path Data="{StaticResource LinkGeometry}"
                                      Width="16"
                                      Height="16"
                                      Stretch="Uniform"
                                      Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" />
                            </Button>
                            <Button Classes="BasicTight TaskQueueBasicTight SyncButton"
                                    ClipToBounds="False"
                                    Command="{Binding RefreshCommand}"
                                    IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                                    Padding="0"
                                    Width="24"
                                    IsVisible="{calcBinding:Binding 'CurrentController != maa:MaaControllerTypes.PlayCover'}"
                                    Height="24"
                                    HorizontalContentAlignment="Center"
                                    VerticalContentAlignment="Center"
                                    ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.TooltipRefresh}}"
                                    VerticalAlignment="Center">
                                <Path Data="{StaticResource RefreshGeometry}"
                                      Width="16"
                                      Height="16"
                                      Stretch="Uniform"
                                      Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" />
                            </Button>
                            <ContentControl
                                Content="{Binding IsConnected, Converter={StaticResource ConnectedConditionConverterCompact}, Source={x:Static helper:Instances.TaskQueueViewModel}}" />
                        </StackPanel>
                    </Grid>
                </Grid>
            </Grid>
        </suki:GlassCard>

        <dashboard:DashboardCardGrid Grid.Row="1" Margin="-5 -2 -5 -5"
                                     x:Name="TaskQueueDashboardGrid"
                                     GridId="TaskQueueView"
                                     Columns="12"
                                     Rows="8"
                                     CellSpacing="10">
            <dashboard:DashboardCard x:Name="SettingCard"
                                     CardId="settings"
                                     GridColumn="4"
                                     GridRow="0"
                                     GridColumnSpan="4"
                                     GridRowSpan="5"
                                     ExpandedColumnSpan="4"
                                     ExpandedRowSpan="5">
                <dashboard:DashboardCard.TitleContent>
                    <TextBlock FontSize="11"
                               FontWeight="Bold"
                               Foreground="{DynamicResource SukiLowText}"
                               Margin="2,0,0,0"
                               Text="{markup:I18n {x:Static helper:LangKeys.TaskSettings}}"
                               VerticalAlignment="Center" />
                </dashboard:DashboardCard.TitleContent>
                <dashboard:DashboardCard.HeaderActions>
                    <StackPanel x:Name="SettingsHeaderButtons"
                                Margin="2 0 0 5"
                                Orientation="Horizontal"
                                HorizontalAlignment="Right"
                                IsVisible="{Binding ShowSettings}"
                                Spacing="8">
                        <RadioButton FontSize="11" FontWeight="Bold"
                                     Classes="Inner"
                                     IsChecked="{Binding IsCommon}"
                                     GroupName="SettingA">
                            <TextBlock Text="{markup:I18n {x:Static helper:LangKeys.CommonSetting}}" />
                        </RadioButton>
                        <RadioButton FontSize="11" FontWeight="Bold"
                                     Classes="Inner"
                                     GroupName="SettingA"
                                     IsChecked="{calcBinding:Binding '!IsCommon'}">
                            <TextBlock Text="{markup:I18n {x:Static helper:LangKeys.AdvancedSetting}}" />
                        </RadioButton>
                    </StackPanel>
                </dashboard:DashboardCard.HeaderActions>
                <ScrollViewer x:Name="SettingsContent"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch"
                              VerticalScrollBarVisibility="Auto"
                              OpacityMask="{Binding (ex:ScrollViewerExtensions.EdgeFadeMask), ElementName=SettingsContent}"
                              ex:ScrollViewerExtensions.EnableEdgeFade="True">
                    <Grid>
                        <StackPanel IsVisible="{calcBinding:Binding 'IsCommon'}"
                                    x:Name="CommonOptionSettings"
                                    Orientation="Vertical" />
                        <StackPanel IsVisible="{calcBinding:Binding '!IsCommon'}"
                                    x:Name="AdvancedOptionSettings"
                                    Orientation="Vertical" />
                    </Grid>
                </ScrollViewer>
            </dashboard:DashboardCard>

            <dashboard:DashboardCard x:Name="TaskListCard"
                                     CardId="task_list"
                                     GridColumn="0"
                                     GridRow="0"
                                     GridColumnSpan="4"
                                     GridRowSpan="8"
                                     ExpandedColumnSpan="4"
                                     ExpandedRowSpan="8">
                <dashboard:DashboardCard.TitleContent>
                    <TextBlock FontSize="11"
                               FontWeight="Bold"
                               Foreground="{DynamicResource SukiLowText}"
                               Margin="2,0,0,0"
                               Text="{markup:I18n {x:Static helper:LangKeys.TaskList}}"
                               VerticalAlignment="Center" />
                </dashboard:DashboardCard.TitleContent>
                <dashboard:DashboardCard.HeaderActions>
                    <StackPanel x:Name="TaskListHeaderButtons"
                                HorizontalAlignment="Right"
                                Margin="2,0,2,0"
                                Orientation="Horizontal"
                                VerticalAlignment="Center"
                                Spacing="8">
                        <Button Classes="BasicTight TaskQueueBasicTight"
                                ClipToBounds="False"
                                Command="{Binding SelectAllCommand}"
                                Height="16"
                                IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                                Margin="7,0,0,0"
                                Padding="0"
                                ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.SelectAll}}"
                                Width="16">
                            <fluent:FluentIcon Icon="SelectAllOn" IconSize="Size16" IconVariant="Regular" />
                        </Button>
                        <Button Classes="BasicTight TaskQueueBasicTight"
                                ClipToBounds="False"
                                Command="{Binding SelectNoneCommand}"
                                Height="16"
                                IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                                Margin="7,0,0,0"
                                Padding="0"
                                ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.DeselectAll}}"
                                Width="16">
                            <fluent:FluentIcon Icon="SelectAllOff" IconSize="Size16" IconVariant="Regular" />
                        </Button>
                        <Button Classes="BasicTight TaskQueueBasicTight"
                                ClipToBounds="False"
                                Command="{Binding AddTaskCommand}"
                                Height="16"
                                IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                                Margin="7,0,0,0"
                                Padding="0"
                                ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.AddTask}}">
                            <fluent:FluentIcon Icon="AddSquareMultiple" IconSize="Size16" IconVariant="Regular" />
                        </Button>
                        <Button Classes="BasicTight TaskQueueBasicTight SyncButton"
                                Command="{Binding ResetTasksCommand}"
                                IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                                Margin="2,0,2,0"
                                Padding="0"
                                Width="24"
                                Height="24"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"
                                ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.Reset}}">
                            <Path Data="{StaticResource RefreshGeometry}"
                                  Width="16"
                                  Height="16"
                                  Stretch="Uniform"
                                  Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" />
                        </Button>
                        <Button Classes="BasicTight PlayStopButton"
                                IsEnabled="{Binding ToggleEnable}"
                                Command="{Binding ToggleCommand}"
                                FontWeight="DemiBold"
                                Height="28"
                                Width="28"
                                Padding="0"
                                Margin="0,0,7,0"
                                Cursor="Hand"
                                Background="Transparent"
                                BorderThickness="0"
                                ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.StartTask}}">
                            <Button.IsVisible>
                                <MultiBinding Converter="{x:Static converters:BooleanAndConverter.NegateSecond}">
                                    <Binding Path="IsCompactMode"
                                             Source="{x:Static helper:Instances.TaskQueueViewModel}" />
                                    <Binding Path="IsRunning"
                                             Source="{x:Static helper:Instances.RootViewModel}" />
                                </MultiBinding>
                            </Button.IsVisible>
                            <Path Data="{StaticResource PlayGeometry}"
                                  Fill="{DynamicResource SukiPrimaryColor}"
                                  Width="12"
                                  Height="12"
                                  Stretch="Uniform"
                                  VerticalAlignment="Center"
                                  HorizontalAlignment="Center" />
                        </Button>
                        <Button Classes="BasicTight PlayStopButton"
                                IsEnabled="{Binding ToggleEnable}"
                                Command="{Binding ToggleCommand}"
                                FontWeight="DemiBold"
                                Height="28"
                                Width="28"
                                Padding="0"
                                Margin="0,0,7,0"
                                Cursor="Hand"
                                Background="Transparent"
                                BorderThickness="0"
                                ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.StopTask}}">
                            <Button.IsVisible>
                                <MultiBinding Converter="{x:Static converters:BooleanAndConverter.Instance}">
                                    <Binding Path="IsCompactMode"
                                             Source="{x:Static helper:Instances.TaskQueueViewModel}" />
                                    <Binding Path="IsRunning"
                                             Source="{x:Static helper:Instances.RootViewModel}" />
                                </MultiBinding>
                            </Button.IsVisible>
                            <Path Data="{StaticResource StopGeometry}"
                                  Fill="{DynamicResource SukiPrimaryColor}"
                                  Width="12"
                                  Height="12"
                                  Stretch="Uniform"
                                  VerticalAlignment="Center"
                                  HorizontalAlignment="Center" />
                        </Button>
                    </StackPanel>
                </dashboard:DashboardCard.HeaderActions>
                <Grid>
                    <ListBox Classes="Fluent"
                             DragDrop.AllowDrop="{Binding Idle,Source={x:Static helper:Instances.RootViewModel}}"
                             ex:DragDropExtensions.EnableDragDrop="True"
                             ex:DragDropExtensions.DragStartThreshold="2"
                             ex:DragDropExtensions.EnableAnimation="True"
                             ex:ScrollViewerExtensions.EnableEdgeFade="True"
                             ItemsSource="{Binding Path=TaskItemViewModels}"
                             Margin="0,3,0,0"
                             MinHeight="150"
                             HorizontalAlignment="Stretch"
                             ScrollViewer.VerticalScrollBarVisibility="Auto"
                             SelectionChanged="SelectingItemsControl_OnSelectionChanged"
                             KeyDown="TaskListBox_OnKeyDown"
                             x:Name="TaskListBox">
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel />
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                        <ListBox.Styles>
                            <Style Selector="ListBoxItem" x:DataType="valueType:DragItemViewModel">
                                <Setter Property="IsVisible" Value="{Binding IsResourceSupported}" />
                            </Style>
                        </ListBox.Styles>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.TooltipDragLabel}}"
                                      Background="Transparent"
                                      ex:DragDropExtensions.LimitDragDrop="True"
                                      ColumnDefinitions="*,Auto"
                                      ContextMenu="{StaticResource TaskMenu}"
                                      x:Name="ListGrid">
                                    <CheckBox IsThreeState="True"
                                              Content="{Binding }"
                                              Grid.Column="0"
                                              MinWidth="150"
                                              ex:CheckBoxExtensions.EnableRightClickNull="{Binding !IsResourceOptionItem}"
                                              HorizontalAlignment="Left"
                                              ex:CheckBoxExtensions.LimitDragDrop="True"
                                              IsEnabled="{Binding !IsResourceOptionItem}"
                                              IsChecked="{Binding IsCheckedWithNull}">
                                        <CheckBox.ContentTemplate>
                                            <DataTemplate x:DataType="valueType:DragItemViewModel">
                                                <Grid ColumnDefinitions="Auto,*">
                                                    <controls:DisplayIcon Grid.Column="0"
                                                                          IconSource="{Binding ResolvedIcon}"
                                                                          IconSize="20"
                                                                          IsVisible="{Binding HasIcon}"
                                                                          Margin="0,0,6,0"
                                                                          VerticalAlignment="Center" />
                                                    <TextBlock Grid.Column="1"
                                                               Text="{Binding Name}"
                                                               TextTrimming="CharacterEllipsis"
                                                               TextWrapping="NoWrap" />
                                                </Grid>
                                            </DataTemplate>
                                        </CheckBox.ContentTemplate>
                                    </CheckBox>
                                    <RadioButton Classes="Icon"
                                                 Background="Transparent"
                                                 IsHitTestVisible="False"
                                                 BorderThickness="0"
                                                 IsChecked="{Binding EnableSetting}"
                                                 Grid.Column="1"
                                                 ex:IconElement.Width="16"
                                                 ex:IconElement.Height="16"
                                                 ex:IconElement.Geometry="{x:Static suki:Icons.Setting}"
                                                 GroupName="TaskSettings"
                                                 IsVisible="{Binding IsVisible}"
                                                 HorizontalContentAlignment="Right" />
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </dashboard:DashboardCard>

            <dashboard:DashboardCard x:Name="IntroductionCard"
                                     CardId="task_desc"
                                     GridColumn="4"
                                     GridRow="5"
                                     GridColumnSpan="4"
                                     GridRowSpan="3"
                                     ExpandedColumnSpan="4"
                                     ExpandedRowSpan="3">
                <dashboard:DashboardCard.TitleContent>
                    <TextBlock FontSize="11"
                               FontWeight="Bold"
                               Foreground="{DynamicResource SukiLowText}"
                               Margin="2,0,0,0"
                               Text="{markup:I18n {x:Static helper:LangKeys.TaskDescription}}"
                               VerticalAlignment="Center" />
                </dashboard:DashboardCard.TitleContent>

                <mdxaml:MarkdownScrollViewer Focusable="True"
                                             x:Name="Introduction"
                                             Margin="10,5,10,5">
                    <mdxaml:MarkdownScrollViewer.Engine>
                        <ex:MarkdownExtension />
                    </mdxaml:MarkdownScrollViewer.Engine>
                    <mdxaml:MarkdownScrollViewer.Styles>
                        <StyleInclude Source="avares://MFAAvalonia/Assets/Style/MdXamlDocStyle.axaml" />
                    </mdxaml:MarkdownScrollViewer.Styles>
                    <mdxaml:MarkdownScrollViewer.Plugins>
                        <StaticResource ResourceKey="MdXamlPlugin" />
                    </mdxaml:MarkdownScrollViewer.Plugins>
                </mdxaml:MarkdownScrollViewer>

            </dashboard:DashboardCard>

            <dashboard:DashboardCard x:Name="LiveViewCard"
                                     CardId="live_view"
                                     GridColumn="8"
                                     GridRow="0"
                                     GridColumnSpan="4"
                                     GridRowSpan="4"
                                     ExpandedColumnSpan="4"
                                     ExpandedRowSpan="4"
                                     CollapsedHeight="40">
                <dashboard:DashboardCard.TitleContent>
                    <TextBlock FontSize="11"
                               FontWeight="Bold"
                               Foreground="{DynamicResource SukiLowText}"
                               Margin="2,0,0,0"
                               Text="{markup:I18n {x:Static helper:LangKeys.LiveView}}"
                               VerticalAlignment="Center" />
                </dashboard:DashboardCard.TitleContent>
                <Grid IsVisible="{Binding IsLiveViewExpanded, Source={x:Static helper:Instances.TaskQueueViewModel}}"
                      Margin="0,8,0,0"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Top">
                    <Border x:Name="LiveViewFrame"
                            CornerRadius="12"
                            ClipToBounds="True"
                            Background="Transparent"
                            BorderBrush="{DynamicResource SukiControlBorderBrush}"
                            BorderThickness="0"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center">
                        <Border CornerRadius="12" ClipToBounds="True">
                            <Image
                                Source="{Binding LiveViewImage, Source={x:Static helper:Instances.TaskQueueViewModel}}"
                                IsVisible="{Binding LiveViewImage, Source={x:Static helper:Instances.TaskQueueViewModel}, Converter={x:Static ObjectConverters.IsNotNull}}"
                                Stretch="Uniform"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" />
                        </Border>
                    </Border>

                    <Grid
                        Width="{Binding Bounds.Width, ElementName=LiveViewFrame}"
                        Height="{Binding Bounds.Height, ElementName=LiveViewFrame}"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Center"
                        IsHitTestVisible="False"
                        RowDefinitions="Auto,*"
                        ColumnDefinitions="Auto,*">

                        <Grid Grid.Row="0" Grid.Column="0"
                              Margin="8 8 0 0"
                              HorizontalAlignment="Left"
                              VerticalAlignment="Top">
                            <Grid.IsVisible>
                                <MultiBinding Converter="{x:Static converters:BooleanAndConverter.Instance}">
                                    <Binding Path="IsRunning"
                                             Source="{x:Static helper:Instances.RootViewModel}" />
                                    <Binding Path="LiveViewImage"
                                             Source="{x:Static helper:Instances.TaskQueueViewModel}"
                                             Converter="{x:Static ObjectConverters.IsNotNull}" />
                                </MultiBinding>
                            </Grid.IsVisible>
                            <Border Background="{DynamicResource SukiCardBackground}"
                                    BorderBrush="{DynamicResource SukiControlBorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="12"
                                    Opacity="0.66" />
                            <StackPanel Orientation="Horizontal" Spacing="6" Margin="8,4">
                                <Grid Width="16" Height="16" VerticalAlignment="Center">
                                    <Ellipse x:Name="PulseRing1"
                                             Width="8"
                                             Height="8"
                                             Fill="Transparent"
                                             Stroke="{DynamicResource SukiSuccessColor}"
                                             StrokeThickness="2"
                                             Opacity="0"
                                             HorizontalAlignment="Center"
                                             VerticalAlignment="Center"
                                             RenderTransformOrigin="50%,50%">
                                        <Ellipse.RenderTransform>
                                            <ScaleTransform ScaleX="1" ScaleY="1" />
                                        </Ellipse.RenderTransform>
                                    </Ellipse>
                                    <Ellipse x:Name="PulseRing2"
                                             Width="8"
                                             Height="8"
                                             Fill="Transparent"
                                             Stroke="{DynamicResource SukiSuccessColor}"
                                             StrokeThickness="2"
                                             Opacity="0"
                                             HorizontalAlignment="Center"
                                             VerticalAlignment="Center"
                                             RenderTransformOrigin="50%,50%">
                                        <Ellipse.RenderTransform>
                                            <ScaleTransform ScaleX="1" ScaleY="1" />
                                        </Ellipse.RenderTransform>
                                    </Ellipse>
                                    <Ellipse x:Name="LiveStatusDot"
                                             Width="8"
                                             Height="8"
                                             Fill="{DynamicResource SukiSuccessColor}"
                                             HorizontalAlignment="Center"
                                             VerticalAlignment="Center"
                                             RenderTransformOrigin="50%,50%">
                                        <Ellipse.RenderTransform>
                                            <ScaleTransform ScaleX="1" ScaleY="1" />
                                        </Ellipse.RenderTransform>
                                    </Ellipse>
                                </Grid>
                                <TextBlock Text="{markup:I18n {x:Static helper:LangKeys.Running}}"
                                           FontSize="11"
                                           Foreground="{DynamicResource SukiSuccessColor}"
                                           VerticalAlignment="Center" />
                            </StackPanel>
                        </Grid>
                        <Grid Grid.Row="0" Grid.Column="1"
                              HorizontalAlignment="Right" Margin="0 8 8 0"
                              VerticalAlignment="Top">
                            <Grid.IsVisible>
                                <MultiBinding Converter="{x:Static converters:BooleanAndConverter.Instance}">
                                    <Binding Path="CurrentTaskName"
                                             Converter="{x:Static StringConverters.IsNotNullOrEmpty}" />
                                    <Binding Path="LiveViewImage"
                                             Converter="{x:Static ObjectConverters.IsNotNull}" />
                                </MultiBinding>
                            </Grid.IsVisible>
                            <Border Background="{DynamicResource SukiCardBackground}"
                                    BorderBrush="{DynamicResource SukiControlBorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="12"
                                    Opacity="0.66" />
                            <StackPanel Orientation="Horizontal" Margin="8,4">
                                <TextBlock Text="{markup:I18n {x:Static helper:LangKeys.Task}}"
                                           FontSize="11"
                                           Foreground="{DynamicResource SukiText}" />
                                <TextBlock Text=": " FontSize="11" Foreground="{DynamicResource SukiText}" />
                                <TextBlock
                                    Text="{Binding CurrentTaskName, Source={x:Static helper:Instances.TaskQueueViewModel}}"
                                    FontSize="11"
                                    Foreground="{DynamicResource SukiText}" />
                            </StackPanel>
                        </Grid>

                        <Grid Grid.Row="1" Grid.Column="0"
                              HorizontalAlignment="Left" Margin="8 0 0 8"
                              VerticalAlignment="Bottom"
                              IsVisible="{Binding LiveViewImage, Source={x:Static helper:Instances.TaskQueueViewModel}, Converter={x:Static ObjectConverters.IsNotNull}}">
                            <Border Background="{DynamicResource SukiCardBackground}"
                                    BorderBrush="{DynamicResource SukiControlBorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="12"
                                    Opacity="0.66" />
                            <TextBlock Margin="8,4"
                                       FontSize="11"
                                       Foreground="{DynamicResource SukiText}"
                                       Text="{Binding LiveViewFps, Source={x:Static helper:Instances.TaskQueueViewModel}, StringFormat='FPS: {0:F1}'}" />

                        </Grid>
                    </Grid>
                </Grid>
            </dashboard:DashboardCard>

            <dashboard:DashboardCard x:Name="LogCard"
                                     CardId="log"
                                     GridColumn="8"
                                     GridRow="4"
                                     GridColumnSpan="4"
                                     GridRowSpan="4"
                                     ExpandedColumnSpan="4"
                                     ExpandedRowSpan="4">
                <dashboard:DashboardCard.TitleContent>
                    <TextBlock FontSize="11"
                               FontWeight="Bold"
                               Foreground="{DynamicResource SukiLowText}"
                               Margin="2,0,0,0"
                               Text="{markup:I18n {x:Static helper:LangKeys.LogRecord}}"
                               VerticalAlignment="Center" />
                </dashboard:DashboardCard.TitleContent>
                <dashboard:DashboardCard.HeaderActions>
                    <StackPanel Orientation="Horizontal"
                                ClipToBounds="False"
                                HorizontalAlignment="Right">
                        <Button Classes="BasicTight TaskQueueBasicTight"
                                Command="{Binding ExportCommand}"
                                IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                                Padding="0"
                                Margin="3,-3,3,0"
                                ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.ExportLog}}"
                                VerticalAlignment="Center">
                            <avalonia1:FluentIcon Height="20"
                                                  Icon="FolderArrowRight"
                                                  IconSize="Size16"
                                                  VerticalAlignment="Center"
                                                  IconVariant="Regular" />
                        </Button>
                        <Button Classes="BasicTight TaskQueueBasicTight SyncButton"
                                Command="{Binding ClearCommand}"
                                IsEnabled="{Binding Idle, Source={x:Static helper:Instances.RootViewModel}}"
                                Margin="3,0,3,0"
                                Padding="0"
                                Width="24"
                                Height="24"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"
                                ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.ButtonClear}}"
                                VerticalAlignment="Center">

                            <Path Data="{StaticResource RefreshGeometry}"
                                  Width="16"
                                  Height="16"
                                  Stretch="Uniform"
                                  Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" />
                        </Button>
                    </StackPanel>
                </dashboard:DashboardCard.HeaderActions>
                <ScrollViewer BorderBrush="LightGray"
                              BorderThickness="1"
                              ClipToBounds="False"
                              Margin="15,8,10,5"
                              VerticalAlignment="Top"
                              VerticalContentAlignment="Top"
                              ex:ScrollViewerExtensions.AutoScroll="True"
                              ex:ScrollViewerExtensions.PanningMode="VerticalOnly">
                    <ItemsControl ItemsSource="{Binding Path=LogItemViewModels}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Spacing="8" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Name="ParentGrid">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.Resources>
                                        <suki:IfConditionConverter x:Key="IfConditionConverter">
                                            <suki:IfConditionConverter.False>
                                                <DataTemplate DataType="other:LogItemViewModel">
                                                    <TextBlock FontSize="12"
                                                               FontWeight="{Binding Weight}"
                                                               Foreground="{Binding Color}"
                                                               Background="{Binding BackgroundColor}"
                                                               HorizontalAlignment="Stretch"
                                                               IsVisible="{Binding !UseMarkdown}"
                                                               Margin="0,4.8,0,0"
                                                               TextWrapping="WrapWithOverflow"
                                                               Text="{Binding Content}"
                                                               VerticalAlignment="Stretch" />
                                                </DataTemplate>
                                            </suki:IfConditionConverter.False>
                                            <suki:IfConditionConverter.True>
                                                <DataTemplate DataType="other:LogItemViewModel">
                                                    <mdxaml:MarkdownScrollViewer IsVisible="{Binding UseMarkdown}"
                                                            Markdown="{Binding Content}"
                                                            Margin="0,4.8,0,0">
                                                        <mdxaml:MarkdownScrollViewer.Engine>
                                                            <ex:MarkdownExtension />
                                                        </mdxaml:MarkdownScrollViewer.Engine>
                                                        <mdxaml:MarkdownScrollViewer.Styles>
                                                            <StyleInclude
                                                                Source="avares://MFAAvalonia/Assets/Style/MdXamlDocStyle.axaml" />
                                                        </mdxaml:MarkdownScrollViewer.Styles>
                                                        <mdxaml:MarkdownScrollViewer.Plugins>
                                                            <StaticResource ResourceKey="MdXamlPlugin" />
                                                        </mdxaml:MarkdownScrollViewer.Plugins>
                                                    </mdxaml:MarkdownScrollViewer>
                                                </DataTemplate>
                                            </suki:IfConditionConverter.True>
                                        </suki:IfConditionConverter>
                                    </Grid.Resources>
                                    <TextBlock FontSize="12"
                                               Name="FirstCol"
                                               Foreground="{DynamicResource SukiDisabledText}"
                                               Grid.Column="0"
                                               HorizontalAlignment="Left"
                                               IsVisible="{Binding ShowTime}"
                                               Margin="0,5,2,0"
                                               MinWidth="55"
                                               Text="{Binding Time}"
                                               TextWrapping="Wrap"
                                               VerticalAlignment="Top" />
                                    <ContentControl Grid.Column="1"
                                                    Content="{Binding}"
                                                    HorizontalAlignment="Stretch"
                                                    VerticalAlignment="Top"
                                                    ContentTemplate="{Binding UseMarkdown,Converter={StaticResource IfConditionConverter}}">
                                        <ContentControl.MaxWidth>
                                            <MultiBinding Converter="{converters:MaxWidthConverter}">
                                                <Binding ElementName="ParentGrid" Path="Bounds.Width" />
                                                <Binding ElementName="FirstCol" Path="Bounds.Width" />
                                            </MultiBinding>
                                        </ContentControl.MaxWidth>
                                    </ContentControl>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </dashboard:DashboardCard>
        </dashboard:DashboardCardGrid>
        <!-- -->
        <!-- ~1~ ~2~ 第二行：三栏布局 @2@ @1@ -->
        <!-- ~1~ ~2~ 竖屏模式下的任务设置 Popup @2@ @1@ -->
        <!-- <Popup x:Name="TaskSettingsPopup" -->
        <!--        IsLightDismissEnabled="True" -->
        <!--        Placement="Center" -->
        <!--        PlacementTarget="{Binding #MainGrid}" -->
        <!--        IsOpen="{Binding IsSettingsPopupOpen, Source={x:Static helper:Instances.TaskQueueViewModel}, Mode=TwoWay}"> -->
        <!--     <Border CornerRadius="15" -->
        <!--             MaxWidth="450" -->
        <!--             MaxHeight="600" -->
        <!--             MinWidth="300" -->
        <!--             Margin="20" Background="{DynamicResource GlassBorderBrush}" -->
        <!--             BoxShadow="0 8 32 0 #40000000"> -->
        <!--         <suki:GlassCard IsAnimated="False" Padding="20"> -->
        <!--             <suki:GlassCard.Resources> -->
        <!--                 <suki:IfConditionConverter x:Key="PopupIfConditionConverter"> -->
        <!--                     <suki:IfConditionConverter.True> -->
        <!--                         <Thickness>0,1,0,10</Thickness> -->
        <!--                     </suki:IfConditionConverter.True> -->
        <!--                     <suki:IfConditionConverter.False> -->
        <!--                         <Thickness>0,10,0,10</Thickness> -->
        <!--                     </suki:IfConditionConverter.False> -->
        <!--                 </suki:IfConditionConverter> -->
        <!--             </suki:GlassCard.Resources> -->
        <!--             <ScrollViewer x:Name="PopupSettingsContent" -->
        <!--                           VerticalScrollBarVisibility="Auto" -->
        <!--                           OpacityMask="{Binding (ex:ScrollViewerExtensions.EdgeFadeMask), ElementName=PopupSettingsContent}" -->
        <!--                           ex:ScrollViewerExtensions.EnableEdgeFade="True"> -->
        <!--                 <Grid RowDefinitions="Auto,Auto"> -->
        <!--                     <suki:GroupBox Grid.Row="0" IsVisible="{Binding HasPopupSettings}" -->
        <!--                                    SeparatorMargin="{Binding ShowSettings, Converter={StaticResource PopupIfConditionConverter}}"> -->
        <!--                         <suki:GroupBox.Header> -->
        <!--                             <DockPanel> -->
        <!--                                 <Button Classes="Basic PanelToggleButton" DockPanel.Dock="Right" -->
        <!--                                         Command="{Binding CloseSettingsPopupCommand, Source={x:Static helper:Instances.TaskQueueViewModel}}" -->
        <!--                                         Padding="2" Margin="0,-5,0,0" -->
        <!--                                         Width="24" Height="24" CornerRadius="4" -->
        <!--                                         ToolTip.Tip="{markup:I18n {x:Static helper:LangKeys.ButtonClose}}"> -->
        <!--                                     <avalonia1:FluentIcon Icon="Dismiss" IconSize="Size16" /> -->
        <!--                                 </Button> -->
        <!--                                 <TextBlock DockPanel.Dock="Left" -->
        <!--                                            FontSize="13" -->
        <!--                                            FontWeight="Bold" Foreground="{DynamicResource SukiText}" -->
        <!--                                            HorizontalAlignment="Left" -->
        <!--                                            Margin="2,0,0,0" -->
        <!--                                            Text="{markup:I18n {x:Static helper:LangKeys.TaskSettings}}" -->
        <!--                                            VerticalAlignment="Center" /> -->
        <!--                                 <StackPanel Margin="10,0,10,5" Orientation="Horizontal" -->
        <!--                                             HorizontalAlignment="Right" -->
        <!--                                             DockPanel.Dock="Right" -->
        <!--                                             IsVisible="{Binding ShowSettings}" Spacing="8"> -->
        <!--                                     <RadioButton FontSize="11" FontWeight="Bold" -->
        <!--                                                  Classes="Inner" IsChecked="{Binding IsCommon}" -->
        <!--                                                  GroupName="PopupSettingA"> -->
        <!--                                         <TextBlock -->
        <!--                                             Text="{markup:I18n {x:Static helper:LangKeys.CommonSetting}}" /> -->
        <!--                                     </RadioButton> -->
        <!--                                     <RadioButton FontSize="11" FontWeight="Bold" Classes="Inner" -->
        <!--                                                  GroupName="PopupSettingA" -->
        <!--                                                  IsChecked="{calcBinding:Binding '!IsCommon'}"> -->
        <!--                                         <TextBlock -->
        <!--                                             Text="{markup:I18n {x:Static helper:LangKeys.AdvancedSetting}}" /> -->
        <!--                                     </RadioButton> -->
        <!--                                 </StackPanel> -->
        <!--                             </DockPanel> -->
        <!--                         </suki:GroupBox.Header> -->
        <!-- -->
        <!--                         <Grid> -->
        <!--                             <StackPanel IsVisible="{calcBinding:Binding 'IsCommon'}" -->
        <!--                                         x:Name="PopupCommonOptionSettings" Orientation="Vertical" /> -->
        <!--                             <StackPanel IsVisible="{calcBinding:Binding '!IsCommon'}" -->
        <!--                                         x:Name="PopupAdvancedOptionSettings" Orientation="Vertical" /> -->
        <!--                         </Grid> -->
        <!--                     </suki:GroupBox> -->
        <!--                     <suki:GroupBox Grid.Row="1" Margin="0 10 0 0" -->
        <!--                                    IsVisible="{Binding HasPopupIntroduction}"> -->
        <!--                         <suki:GroupBox.Header> -->
        <!--                             <TextBlock FontSize="13" FontWeight="Bold" -->
        <!--                                        Text="{markup:I18n {x:Static helper:LangKeys.TaskDescription}}" /> -->
        <!--                         </suki:GroupBox.Header> -->
        <!--                         <ScrollViewer> -->
        <!--                             <mdxaml:MarkdownScrollViewer x:Name="PopupIntroduction" -->
        <!--                                                          Markdown="{Binding PopupIntroductionContent}"> -->
        <!--                                 <mdxaml:MarkdownScrollViewer.Engine> -->
        <!--                                     <ex:MarkdownExtension /> -->
        <!--                                 </mdxaml:MarkdownScrollViewer.Engine> -->
        <!--                                 <mdxaml:MarkdownScrollViewer.Styles> -->
        <!--                                     <StyleInclude -->
        <!--                                         Source="avares://MFAAvalonia/Assets/Style/MdXamlDocStyle.axaml" /> -->
        <!--                                 </mdxaml:MarkdownScrollViewer.Styles> -->
        <!--                                 <mdxaml:MarkdownScrollViewer.Plugins> -->
        <!--                                     <StaticResource ResourceKey="MdXamlPlugin" /> -->
        <!--                                 </mdxaml:MarkdownScrollViewer.Plugins> -->
        <!--                             </mdxaml:MarkdownScrollViewer> -->
        <!--                         </ScrollViewer> -->
        <!--                     </suki:GroupBox> -->
        <!--                 </Grid> -->
        <!--             </ScrollViewer> -->
        <!--         </suki:GlassCard> -->
        <!--     </Border> -->
        <!-- </Popup> -->
    </Grid>
</UserControl>