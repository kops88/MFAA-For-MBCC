# 自定义布局（Dashboard）

本页说明如何通过 `mfa_layout.json` 自定义 Dashboard 卡片布局。
同时说明读取/写入规则与资源开发的小技巧。

---

## 放置位置

MFA 会在程序目录下的 `resource` 文件夹中**递归查找**第一个 `mfa_layout.json` 并读取。

推荐放置路径：
- `resource/mfa_layout.json`
- 或 `resource/base/mfa_layout.json`

写入规则：
- 当程序需要生成布局文件时，会写入 `resource/mfa_layout.json`

---

## 文件结构

`mfa_layout.json` 由两部分组成：

- 全局布局参数：`rows`、`columns`、`spacing`
- 每个卡片的布局配置：以卡片 ID 为键

示例：

```json
{
  "rows": 3,
  "columns": 4,
  "spacing": 10,
  "TaskList": {
    "row": 0,
    "col": 0,
    "row_span": 2,
    "col_span": 2
  },
  "LogPanel": {
    "row": 0,
    "col": 2,
    "row_span": 3,
    "col_span": 2
  }
}
```

---

## 默认布局示例

以下为当前默认布局（`TaskQueueView`）的参考 JSON：

```json
{
  "rows": 8,
  "columns": 12,
  "spacing": 10,
  "settings": {
    "row": 0,
    "col": 4,
    "row_span": 5,
    "col_span": 4
  },
  "task_list": {
    "row": 0,
    "col": 0,
    "row_span": 8,
    "col_span": 4
  },
  "task_desc": {
    "row": 5,
    "col": 4,
    "row_span": 3,
    "col_span": 4
  },
  "live_view": {
    "row": 0,
    "col": 8,
    "row_span": 4,
    "col_span": 4
  },
  "log": {
    "row": 4,
    "col": 8,
    "row_span": 4,
    "col_span": 4
  }
}
```
---

## 字段说明

### 全局字段

- `rows`：行数
- `columns`：列数
- `spacing`：格子间距

### 卡片字段

每个卡片字段为一个对象，支持以下键：

- `row`：起始行（从 0 开始）
- `col`：起始列（从 0 开始）
- `row_span` / `rowSpan`：行跨度
- `col_span` / `colSpan`：列跨度

---

## 注意事项

- 不存在的卡片 ID 会被忽略
- 未配置的卡片保持默认布局
- 在 UI 里拖拽/缩放会保存到本地配置，但不会自动写回 `mfa_layout.json`
- 只有当 `rows` 或 `columns` 与当前配置不一致时，才会依据 `mfa_layout.json` 强制刷新配置布局
- 若 `mfa_layout.json` 内容发生变化（哈希变更），会强制应用资源布局并覆盖当前布局

---

## 资源开发小技巧

- 想快速生成新的布局文件：
  1. 先在 `mfa_layout.json` 中调整 `rows` / `columns`
  2. 进入 UI 后按需要拖拽/缩放调整布局
  3. 删除 `mfa_layout.json`
  4. 重新进入界面后会自动生成一份新的布局文件